<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V2rayN è·¯ç”±é…ç½®å·¥å…· V2.0</title>
    <style>
        /* å…¨å±€ç¾åŒ– */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #f0f2f5; 
            color: #333; 
            padding: 30px; 
            line-height: 1.6;
        }
        .container { 
            max-width: 900px; 
            margin: auto; 
            background: #ffffff; 
            padding: 35px; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); 
        }
        h1 { 
            text-align: center; 
            color: #1e88e5; /* è“è‰²ä¸»é¢˜ */
            margin-bottom: 30px; 
            font-weight: 600;
        }

        /* è§„åˆ™åˆ—è¡¨åŒºåŸŸ */
        .section-header { 
            font-size: 1.2em; 
            font-weight: 600; 
            margin-top: 25px; 
            margin-bottom: 15px; 
            color: #555;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 5px;
        }
        .rule-list { 
            border: 1px solid #e0e0e0; 
            border-radius: 8px; 
            padding: 20px; 
            margin-bottom: 20px; 
            background-color: #f9f9f9;
        }
        .rule-row { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 10px; 
            align-items: center; 
        }
        .rule-row input[type="text"], .rule-row select { 
            padding: 10px; 
            border: 1px solid #ccc; 
            border-radius: 6px; 
            flex-grow: 1; 
            font-size: 1em;
        }
        .rule-row select { 
            flex-grow: 0; 
            width: 180px; 
            background-color: white;
        }
        .delete-btn { 
            background-color: #e57373; /* çº¢è‰² */
            color: white; 
            border: none; 
            padding: 10px 15px; 
            border-radius: 6px; 
            cursor: pointer; 
            transition: background-color 0.2s;
        }
        .delete-btn:hover { background-color: #d32f2f; }
        
        /* æ“ä½œæŒ‰é’® */
        .action-button { 
            background-color: #1e88e5; /* è“è‰² */
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 1em;
            transition: background-color 0.2s;
            display: block;
            width: 100%;
            margin-top: 25px;
        }
        .action-button:hover { background-color: #1565c0; }
        #add-rule-btn { margin-top: 0; }

        /* é»˜è®¤ç­–ç•¥é€‰é¡¹ */
        .default-options { 
            padding: 20px; 
            border: 1px solid #bbdefb; 
            border-radius: 8px; 
            background-color: #e3f2fd; /* æµ…è“è‰²èƒŒæ™¯ */
            margin-top: 20px;
        }
        .default-options button { 
            margin-right: 10px; 
            padding: 10px 15px; 
            background-color: #ffb74d; /* æ©™è‰² */
            color: #333; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            transition: background-color 0.2s;
        }
        .default-options button:hover { background-color: #ffa726; }
        .default-options button.active { 
            background-color: #1e88e5; 
            color: white; 
            border: 2px solid #005cb2;
        }
        .policy-text { 
            margin-top: 10px; 
            font-size: 0.9em; 
            color: #0d47a1;
        }

        /* è¾“å‡ºåŒºåŸŸ */
        .output-area { margin-top: 30px; }
        .output-actions { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 10px; 
        }
        #copy-btn { 
            background-color: #4db6ac; /* é’ç»¿è‰² */
            color: white; 
            border: none; 
            padding: 10px 15px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 0.9em; 
        }
        #copy-btn:disabled { 
            background-color: #b0bec5; 
            cursor: not-allowed; 
        }
        textarea { 
            width: 100%; 
            height: 250px; 
            padding: 15px; 
            border: 1px solid #ccc; 
            border-radius: 6px; 
            font-family: monospace; 
            font-size: 0.95em;
            resize: vertical;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>V2rayN è·¯ç”±é…ç½®å·¥å…· V2.0</h1>

    <div class="section-header">ç¬¬ä¸€æ­¥ï¼šè‡ªå®šä¹‰æµé‡åˆ†æµè§„åˆ™ (é«˜ä¼˜å…ˆçº§)</div>

    <div class="rule-list" id="rule-list">
        </div>

    <button id="add-rule-btn" class="action-button">â• æ·»åŠ æ–°è§„åˆ™</button>

    <div class="default-options">
        <div class="section-header" style="margin-top: 0; padding-bottom: 0;">ç¬¬äºŒæ­¥ï¼šæœªåŒ¹é…ç½‘ç«™çš„é»˜è®¤ç­–ç•¥ (å…œåº•)</div>
        <div style="margin-top: 10px;">
            <button id="default-proxy-btn">å…¨éƒ¨ä»£ç†</button>
            <button id="default-direct-btn">å…¨éƒ¨ç›´è¿</button>
            <button id="default-cn-proxy-btn">å¤§é™†ç›´è¿ï¼Œå›½å¤–ä»£ç†</button>
        </div>
        <input type="hidden" id="default-policy" value="cn_proxy"> 
        <div class="policy-text">å½“å‰ç­–ç•¥: <strong id="current-policy-text">å¤§é™†ç›´è¿ï¼Œå›½å¤–ä»£ç†</strong></div>
    </div>

    <button id="generate-btn" class="action-button" style="background-color: #4caf50;">âš™ï¸ ç”Ÿæˆ JSON é…ç½®</button>

    <div class="output-area">
        <div class="output-actions">
            <h3 style="margin: 0; font-size: 1.1em;">ç”Ÿæˆçš„ JSON é…ç½®</h3>
            <button id="copy-btn" disabled>ğŸ“‹ å¤åˆ¶ JSON ä»£ç </button>
        </div>

        <textarea id="output-json" readonly placeholder="ç‚¹å‡»ä¸Šæ–¹ç”ŸæˆæŒ‰é’®ï¼Œè·¯ç”±é…ç½®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œã€‚"></textarea>
    </div>
</div>

<script>
    // --- å…ƒç´ å¼•ç”¨ ---
    const ruleList = document.getElementById('rule-list');
    const addRuleBtn = document.getElementById('add-rule-btn');
    const generateBtn = document.getElementById('generate-btn');
    const outputJson = document.getElementById('output-json');
    const copyBtn = document.getElementById('copy-btn');
    const defaultPolicyInput = document.getElementById('default-policy');
    const currentPolicyText = document.getElementById('current-policy-text');

    const defaultProxyBtn = document.getElementById('default-proxy-btn');
    const defaultDirectBtn = document.getElementById('default-direct-btn');
    const defaultCnProxyBtn = document.getElementById('default-cn-proxy-btn');

    // --- æ ¸å¿ƒå‡½æ•°ï¼šæ·»åŠ è§„åˆ™è¾“å…¥è¡Œ ---
    function addRuleRow(domain = '', tag = 'proxy') {
        const row = document.createElement('div');
        row.className = 'rule-row';

        row.innerHTML = `
            <input type="text" class="domain-input" placeholder="è¾“å…¥åŸŸå (å¦‚: example.com)" value="${domain}">
            <select class="tag-select">
                <option value="proxy" ${tag === 'proxy' ? 'selected' : ''}>ä»£ç† (Proxy)</option>
                <option value="direct" ${tag === 'direct' ? 'selected' : ''}>ç›´è¿ (Direct)</option>
            </select>
            <button class="delete-btn">åˆ é™¤</button>
        `;

        row.querySelector('.delete-btn').addEventListener('click', () => {
            ruleList.removeChild(row);
        });

        ruleList.appendChild(row);
    }

    // --- æ ¸å¿ƒå‡½æ•°ï¼šè®¾ç½®é»˜è®¤ç­–ç•¥ (ä¼˜åŒ–äº†æ´»åŠ¨çŠ¶æ€æ˜¾ç¤º) ---
    function setDefaultPolicy(policyName, text, activeBtn) {
        defaultPolicyInput.value = policyName;
        currentPolicyText.textContent = text;
        
        // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„ active ç±»
        [defaultProxyBtn, defaultDirectBtn, defaultCnProxyBtn].forEach(btn => {
            btn.classList.remove('active');
        });
        // ä¸ºå½“å‰é€‰ä¸­çš„æŒ‰é’®æ·»åŠ  active ç±»
        activeBtn.classList.add('active');
    }

    // --- æ ¸å¿ƒå‡½æ•°ï¼šç”Ÿæˆ JSON è§„åˆ™ (ä¿æŒé€»è¾‘ä¸å˜ï¼Œåªä¿®æ”¹ description) ---
    function generateRules() {
        const rows = ruleList.querySelectorAll('.rule-row');
        let customRules = [];
        let hasError = false;

        rows.forEach(row => {
            const domainInput = row.querySelector('.domain-input');
            const domain = domainInput.value.trim();
            const tag = row.querySelector('.tag-select').value;

            if (domain === '') {
                if (rows.length > 0) { 
                    alert('è¯·åˆ é™¤æˆ–å¡«å†™æ‰€æœ‰è‡ªå®šä¹‰è§„åˆ™çš„åŸŸåï¼');
                    domainInput.focus();
                    hasError = true;
                }
                return;
            }

            customRules.push({
                "type": "field",
                "domain": [domain], 
                "outboundTag": tag 
            });
        });

        if (hasError) {
            outputJson.value = 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯æç¤ºã€‚';
            copyBtn.disabled = true;
            return;
        }

        const defaultPolicy = defaultPolicyInput.value;
        const defaultRules = [];

        if (defaultPolicy === 'all_proxy') {
            defaultRules.push({ "type": "field", "outboundTag": "proxy" });
        } else if (defaultPolicy === 'all_direct') {
            defaultRules.push({ "type": "field", "outboundTag": "direct" });
        } else if (defaultPolicy === 'cn_proxy') {
            defaultRules.push(
                { "type": "field", "domain": ["geosite:cn"], "outboundTag": "direct" },
                { "type": "field", "ip": ["geoip:cn"], "outboundTag": "direct" },
                { "type": "field", "outboundTag": "proxy" }
            );
        }

        const finalConfig = {
            "version": 1,
            "description": "è‡ªå®šä¹‰è·¯ç”±é…ç½® - V2.0", /* æ›´æ–°ç‰ˆæœ¬å· */
            "routing": {
                "domainStrategy": "AsIs",
                "rules": customRules.concat(defaultRules)
            }
        };

        outputJson.value = JSON.stringify(finalConfig, null, 2);
        copyBtn.disabled = false;
    }
    
    // --- å¤åˆ¶åŠŸèƒ½ (ä¿æŒä¸å˜) ---
    async function copyToClipboard() {
        const textToCopy = outputJson.value;
        
        if (!textToCopy) return;

        try {
            await navigator.clipboard.writeText(textToCopy);
            copyBtn.textContent = 'âœ… å·²å¤åˆ¶!';
            setTimeout(() => { copyBtn.textContent = 'ğŸ“‹ å¤åˆ¶ JSON ä»£ç '; }, 2000);
        } catch (err) {
            outputJson.select();
            document.execCommand('copy');
            copyBtn.textContent = 'âœ… å·²å¤åˆ¶! (å¤‡ç”¨)';
            setTimeout(() => { copyBtn.textContent = 'ğŸ“‹ å¤åˆ¶ JSON ä»£ç '; }, 2000);
        }
    }

    // --- äº‹ä»¶ç›‘å¬å™¨ ---
    addRuleBtn.addEventListener('click', () => addRuleRow());
    generateBtn.addEventListener('click', generateRules);
    copyBtn.addEventListener('click', copyToClipboard);

    defaultProxyBtn.addEventListener('click', () => setDefaultPolicy('all_proxy', 'å…¨éƒ¨ä»£ç†', defaultProxyBtn));
    defaultDirectBtn.addEventListener('click', () => setDefaultPolicy('all_direct', 'å…¨éƒ¨ç›´è¿', defaultDirectBtn));
    defaultCnProxyBtn.addEventListener('click', () => setDefaultPolicy('cn_proxy', 'å¤§é™†ç›´è¿ï¼Œå›½å¤–ä»£ç†', defaultCnProxyBtn));


    // é»˜è®¤åŠ è½½ç¤ºä¾‹å’Œé»˜è®¤ç­–ç•¥
    addRuleRow('youtube.com', 'proxy');
    addRuleRow('bing.com', 'direct');
    setDefaultPolicy('cn_proxy', 'å¤§é™†ç›´è¿ï¼Œå›½å¤–ä»£ç†', defaultCnProxyBtn); 
</script>

</body>
</html>

/*
 *                        .::::.
 *                      .::::::::.
 *                     :::::::::::
 *                  ..:::::::::::'
 *               '::::::::::::'
 *                 .::::::::::
 *            '::::::::::::::..
 *                 ..::::::::::::.
 *               ``::::::::::::::::
 *                ::::``:::::::::'        .:::.
 *               ::::'   ':::::'       .::::::::.
 *             .::::'      ::::     .:::::::'::::.
 *            .:::'       :::::  .:::::::::' ':::::.
 *           .::'        :::::.:::::::::'      ':::::.
 *          .::'         ::::::::::::::'         ``::::.
 *      ...:::           ::::::::::::'              ``::.
 *     ````':.          ':::::::::'                  ::::..
 *                        '.:::::'                    ':'````..
 * 
 * Author       : OBKoro1
 * Date         : 2020-04-30 15:51:08
 * LastEditors  : OBKoro1
 * LastEditTime : 2020-05-13 17:24:47
 * FilePath     : \fileHead\test.js
 * Description  : 
 * https://github.com/OBKoro1
 */
